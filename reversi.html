<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>„Ç™„Çª„É≠„Ç≤„Éº„É† („Ç¨„Ç§„ÉâÂàá„ÇäÊõø„ÅàÊ©üËÉΩ‰ªò„Åç)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        /* ======================================= */
        /* CSS„Çª„ÇØ„Ç∑„Éß„É≥ (Â§âÊõ¥„Å™„Åó) */
        /* ======================================= */
        body {
            text-align: center;
            font-family: sans-serif;
            background-color: #f0f0f0;
            padding: 10px;
            margin: 0;
        }

        #game-container {
            width: 95%; 
            max-width: 600px;
            min-width: 300px; 
            margin: 10px auto;
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
        }

        h1 {
            color: #333;
            font-size: 24px;
        }

        #game-info {
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        /* üí°„ÄêËøΩÂä†„Äë„Ç¨„Ç§„Éâ„Ç≥„É≥„Éà„É≠„Éº„É´„ÅÆ„Çπ„Çø„Ç§„É´ */
        #guide-controls {
            margin: 15px 0;
            font-size: 14px;
            padding: 5px;
            border: 1px dashed #ccc;
            border-radius: 5px;
        }
        #guide-controls label {
            margin: 0 8px;
            font-weight: bold;
        }

        #board-wrapper {
            width: 100%;
            padding-bottom: 100%;
            height: 0; 
            position: relative;
        }

        #board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            width: 100%;
            height: 100%;
            border: 4px solid #000;
            background-color: #008000; 
            box-sizing: border-box;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .cell {
            border: 1px solid #005000;
            display: flex; 
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            transition: background-color 0.1s;
            height: 100%;
            box-sizing: border-box;
        }
        
        .cell:hover:not(.stone) {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .stone {
            width: 80%;
            height: 80%;
            border-radius: 50%;
            transition: transform 0.3s, background-color 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
            transform-style: preserve-3d;
            transform: rotateY(0deg); 
            backface-visibility: hidden;
        }

        .black {
            background-color: black;
        }

        .white {
            background-color: white;
            border: 1px solid #ccc;
        }
        
        .flipping-to-white {
            transform: rotateY(180deg);
            background-color: white;
        }
        .flipping-to-black {
            transform: rotateY(0deg);
            background-color: black;
        }
        
        .cell.valid-move {
            background-color: rgba(255, 255, 0, 0.3) !important; 
        }

        #reset-button {
            margin-top: 15px; 
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #3f51b5;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        #reset-button:hover {
            background-color: #303f9f;
        }

        @media (min-width: 600px) {
            h1 { font-size: 28px; }
            #game-info { font-size: 18px; }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>„Ç™„Çª„É≠„Ç≤„Éº„É† (Reversi)</h1>
        
        <div id="game-info">
            <p>ÁèæÂú®„ÅÆ„Çø„Éº„É≥: <span id="current-player">Èªí (Black)</span></p>
            <p>„Çπ„Ç≥„Ç¢: <span id="score-black">2</span> (Èªí) - <span id="score-white">2</span> (ÁôΩ)</p>
        </div>
        
        <div id="guide-controls">
            <label>
                <input type="checkbox" id="guide-black" data-player="1" checked> 
                Èªí„ÅÆ„Ç¨„Ç§„Éâ
            </label>
            <label>
                <input type="checkbox" id="guide-white" data-player="2" checked> 
                ÁôΩ„ÅÆ„Ç¨„Ç§„Éâ
            </label>
        </div>
        
        <div id="board-wrapper">
            <div id="board">
                </div>
        </div>

        <button id="reset-button">„É™„Çª„ÉÉ„Éà</button>
    </div>

    <script>
        /* ======================================= */
        /* JavaScript„Çª„ÇØ„Ç∑„Éß„É≥: „Ç≤„Éº„É†„É≠„Ç∏„ÉÉ„ÇØ */
        /* ======================================= */

        const boardElement = document.getElementById('board');
        const currentPlayerElement = document.getElementById('current-player');
        const scoreBlackElement = document.getElementById('score-black');
        const scoreWhiteElement = document.getElementById('score-white');
        const resetButton = document.getElementById('reset-button');
        const guideControls = document.getElementById('guide-controls'); // üí°ËøΩÂä†

        const EMPTY = 0;
        const BLACK = 1;
        const WHITE = 2;
        const playerNames = { 1: 'Èªí (Black)', 2: 'ÁôΩ (White)' };

        let board = Array(8).fill(0).map(() => Array(8).fill(EMPTY));
        let currentPlayer = BLACK;
        
        // üí°„ÄêËøΩÂä†„Äë„Ç¨„Ç§„ÉâË°®Á§∫Ë®≠ÂÆö
        let guideSettings = { 
            [BLACK]: true, // Èªí„ÅØÂàùÊúüÂÄ§„Ç™„É≥
            [WHITE]: true  // ÁôΩ„ÅØÂàùÊúüÂÄ§„Ç™„É≥
        };

        const directions = [
            [-1, 0], [1, 0], [0, -1], [0, 1],
            [-1, -1], [-1, 1], [1, -1], [1, 1]
        ];

        // -------------------
        // 1. ÂàùÊúüÂåñÂá¶ÁêÜ
        // -------------------

        function initializeGame() {
            board = Array(8).fill(0).map(() => Array(8).fill(EMPTY));
            board[3][3] = WHITE;
            board[3][4] = BLACK;
            board[4][3] = BLACK;
            board[4][4] = WHITE;
            currentPlayer = BLACK;

            drawBoard();
            updateGameInfo();
            // üí° Â∏∏„Å´ÁèæÂú®„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÅÆË®≠ÂÆö„Å´Âü∫„Å•„ÅÑ„Å¶„Éè„Ç§„É©„Ç§„Éà„ÇíÂëº„Å≥Âá∫„Åó
            highlightValidMoves();
        }
        
        // -------------------
        // 2. ÊèèÁîª„ÉªÊõ¥Êñ∞Âá¶ÁêÜ
        // -------------------

        function drawBoard() {
            boardElement.innerHTML = '';
            for (let y = 0; y < 8; y++) {
                for (let x = 0; x < 8; x++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.dataset.y = y;
                    cell.dataset.x = x;

                    if (board[y][x] !== EMPTY) {
                        const stone = document.createElement('div');
                        stone.classList.add('stone');
                        stone.classList.add(board[y][x] === BLACK ? 'black' : 'white');
                        cell.appendChild(stone);
                    }

                    cell.addEventListener('click', handleCellClick);
                    boardElement.appendChild(cell);
                }
            }
        }

        function updateGameInfo() {
            let blackCount = 0;
            let whiteCount = 0;
            let emptyCount = 0;

            for (let y = 0; y < 8; y++) {
                for (let x = 0; x < 8; x++) {
                    if (board[y][x] === BLACK) blackCount++;
                    else if (board[y][x] === WHITE) whiteCount++;
                    else emptyCount++;
                }
            }

            scoreBlackElement.textContent = blackCount;
            scoreWhiteElement.textContent = whiteCount;
            currentPlayerElement.textContent = playerNames[currentPlayer];
            
            checkGameStatus(emptyCount, blackCount, whiteCount);
        }
        
        // -------------------
        // 3. „É≠„Ç∏„ÉÉ„ÇØ„ÅÆÊ†∏ (‰∏ÄÈÉ®ÁúÅÁï•)
        // -------------------
        
        function getFlippableStones(startY, startX, player) {
            const opponent = player === BLACK ? WHITE : BLACK;
            const flippable = [];
            if (board[startY][startX] !== EMPTY) return [];
            for (const [dy, dx] of directions) {
                const stonesInDirection = [];
                let y = startY + dy;
                let x = startX + dx;
                while (y >= 0 && y < 8 && x >= 0 && x < 8 && board[y][x] === opponent) {
                    stonesInDirection.push({ y, x });
                    y += dy;
                    x += dx;
                }
                if (stonesInDirection.length > 0 && y >= 0 && y < 8 && x >= 0 && x < 8 && board[y][x] === player) {
                    flippable.push(...stonesInDirection);
                }
            }
            return flippable;
        }
        
        function flipStones(stones, player) {
            const colorClass = player === BLACK ? 'black' : 'white';
            const flipClass = player === BLACK ? 'flipping-to-black' : 'flipping-to-white';
            for (const { y, x } of stones) {
                board[y][x] = player;
                const cell = boardElement.querySelector(`[data-y="${y}"][data-x="${x}"]`);
                const stoneElement = cell.querySelector('.stone');
                if (stoneElement) {
                    stoneElement.classList.remove('black', 'white', 'flipping-to-black', 'flipping-to-white');
                    stoneElement.classList.add(flipClass);
                    setTimeout(() => {
                        stoneElement.classList.remove('flipping-to-black', 'flipping-to-white');
                        stoneElement.classList.add(colorClass);
                    }, 300);
                }
            }
        }
        
        function hasValidMove(player) {
            for (let y = 0; y < 8; y++) {
                for (let x = 0; x < 8; x++) {
                    if (board[y][x] === EMPTY && getFlippableStones(y, x, player).length > 0) {
                        return true;
                    }
                }
            }
            return false;
        }

        // üí°„Äê‰øÆÊ≠£„Äë„Ç¨„Ç§„ÉâË®≠ÂÆö„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Å¶„Åã„Çâ„Éè„Ç§„É©„Ç§„Éà„ÇíÂÆüË°å
        function highlightValidMoves() {
            // Ââç„ÅÆ„Éè„Ç§„É©„Ç§„Éà„Çí„Åô„Åπ„Å¶„ÇØ„É™„Ç¢ („Éó„É¨„Ç§„É§„Éº„Å´Èñ¢‰øÇ„Å™„Åè„ÇØ„É™„Ç¢)
            document.querySelectorAll('.cell.valid-move').forEach(cell => {
                cell.classList.remove('valid-move');
                cell.style.backgroundColor = ''; 
            });
            
            // ÁèæÂú®„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÅÆ„Ç¨„Ç§„Éâ„ÅåON„ÅÆÂ†¥Âêà„ÅÆ„ÅøÂá¶ÁêÜ„ÇíÂÆüË°å
            if (guideSettings[currentPlayer]) { 
                for (let y = 0; y < 8; y++) {
                    for (let x = 0; x < 8; x++) {
                        if (board[y][x] === EMPTY && getFlippableStones(y, x, currentPlayer).length > 0) {
                            const cell = boardElement.querySelector(`[data-y="${y}"][data-x="${x}"]`);
                            cell.classList.add('valid-move');
                            cell.style.backgroundColor = 'rgba(255, 255, 0, 0.3)'; 
                        }
                    }
                }
            }
        }
        
        function checkGameStatus(emptyCount, blackCount, whiteCount) {
            const blackCanMove = hasValidMove(BLACK);
            const whiteCanMove = hasValidMove(WHITE);

            if (emptyCount === 0 || (!blackCanMove && !whiteCanMove)) {
                let message;
                if (blackCount > whiteCount) {
                    message = `„Ç≤„Éº„É†ÁµÇ‰∫ÜÔºÅÈªí„ÅÆÂãùÂà©ÔºÅ (${blackCount} vs ${whiteCount})`;
                } else if (whiteCount > blackCount) {
                    message = `„Ç≤„Éº„É†ÁµÇ‰∫ÜÔºÅÁôΩ„ÅÆÂãùÂà©ÔºÅ (${blackCount} vs ${whiteCount})`;
                } else {
                    message = `„Ç≤„Éº„É†ÁµÇ‰∫ÜÔºÅÂºï„ÅçÂàÜ„Åë„Åß„ÅôÔºÅ (${blackCount} vs ${whiteCount})`;
                }
                currentPlayerElement.innerHTML = `<span style="color:red;">${message}</span>`;
            } else if (!hasValidMove(currentPlayer)) {
                alert(`${playerNames[currentPlayer]}„ÅØÁΩÆ„Åë„ÇãÂ†¥ÊâÄ„Åå„Å™„ÅÑ„Åü„ÇÅ„Éë„Çπ„Åß„Åô„ÄÇ`);
                currentPlayer = currentPlayer === BLACK ? WHITE : BLACK;
                currentPlayerElement.textContent = playerNames[currentPlayer];
                // „Çø„Éº„É≥„Åå‰∫§‰ª£„Åó„Åü„ÅÆ„Åß„ÄÅÊñ∞„Åó„ÅÑ„Éó„É¨„Ç§„É§„Éº„ÅÆË®≠ÂÆö„Åß„Éè„Ç§„É©„Ç§„Éà
                highlightValidMoves();
            } else {
                // Á∂öË°å„ÅÆÂ†¥Âêà„ÅØÁèæÂú®„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÅÆË®≠ÂÆö„Åß„Éè„Ç§„É©„Ç§„Éà
                highlightValidMoves();
            }
        }


        // -------------------
        // 4. „Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©
        // -------------------

        function handleCellClick(event) {
            const y = parseInt(event.currentTarget.dataset.y);
            const x = parseInt(event.currentTarget.dataset.x);
            
            if (board[y][x] !== EMPTY) {
                return;
            }

            const flippableStones = getFlippableStones(y, x, currentPlayer);

            if (flippableStones.length === 0) {
                return;
            }

            // 1. Áü≥„ÇíÁΩÆ„Åè
            board[y][x] = currentPlayer;
            
            // 2. Áõ§Èù¢„Å´Áü≥„ÅÆDOMË¶ÅÁ¥†„ÇíËøΩÂä†
            const cell = event.currentTarget;
            cell.classList.remove('valid-move');
            cell.style.backgroundColor = ''; 
            
            const stone = document.createElement('div');
            stone.classList.add('stone');
            stone.classList.add(currentPlayer === BLACK ? 'black' : 'white');
            cell.appendChild(stone);

            // 3. Áü≥„Çí„Å≤„Å£„Åè„ÇäËøî„Åô
            flipStones(flippableStones, currentPlayer);

            // 4. „Çø„Éº„É≥‰∫§‰ª£
            currentPlayer = currentPlayer === BLACK ? WHITE : BLACK;

            // 5. „Ç≤„Éº„É†ÊÉÖÂ†±„ÇíÊõ¥Êñ∞ („Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Âæå„Å´Ê¨°„ÅÆ„Çø„Éº„É≥„ÅÆ„Éè„Ç§„É©„Ç§„Éà„ÇíË°å„ÅÜ)
            setTimeout(updateGameInfo, 350); 
        }
        
        // üí°„ÄêËøΩÂä†„Äë„Ç¨„Ç§„ÉâÂàá„ÇäÊõø„Åà„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©
        function handleGuideToggle(event) {
            if (event.target.type === 'checkbox') {
                const player = parseInt(event.target.dataset.player);
                guideSettings[player] = event.target.checked;
                
                // ÁèæÂú®„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÅÆË®≠ÂÆö„ÅåÂ§â„Çè„Å£„ÅüÂ†¥Âêà„ÅØ„ÄÅ„Åô„Åê„Å´„Éè„Ç§„É©„Ç§„Éà„ÇíÊõ¥Êñ∞
                if (player === currentPlayer) {
                    highlightValidMoves();
                }
            }
        }

        resetButton.addEventListener('click', initializeGame);
        guideControls.addEventListener('change', handleGuideToggle); // üí°„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†

        // „Ç≤„Éº„É†ÈñãÂßã
        initializeGame();
    </script>
</body>
</html>