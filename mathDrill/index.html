<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aoi's Math Drill - Mobile Ready</title>
    <style>
        /* 1. 基本設定：A4横 */
        @page { size: A4 landscape; margin: 0; }
        
        @media print {
            html, body { 
                width: 297mm; 
                height: 210mm; 
                overflow: hidden; 
            }
            .no-print { display: none !important; }
            
            /* スマホ等で100%だと切れる場合の保険 */
            .content-wrapper {
                transform: scale(0.96); /* 全体を4%縮小して安全圏に */
                transform-origin: top center;
            }
        }

        /* スマホのプレビュー画面等でも崩れないように */
        @media screen and (max-width: 768px) {
            .content-wrapper {
                width: 1000px; /* 横幅を固定してスマホの自動改行を防ぐ */
                transform: scale(0.35); /* スマホ画面で見やすく縮小 */
                transform-origin: top left;
            }
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            margin: 0; padding: 0; background: #fff;
        }

        .content-wrapper {
            width: 297mm; height: 190mm; 
            padding: 5mm 10mm; box-sizing: border-box;
            display: flex; flex-direction: column;
            margin: 0 auto;
        }

        .header { text-align: center; border-bottom: 3px solid #000; margin-bottom: 5px; position: relative; }
        .header h1 { margin: 0; font-size: 22px; color: #000; }
        
        .landscape-hint {
            position: absolute; right: 0; bottom: 5px;
            font-size: 10px; color: #000; border: 1px solid #000;
            padding: 2px 5px; border-radius: 3px;
        }

        .info-section {
            display: flex; justify-content: flex-end; gap: 20px;
            margin: 5px 0; font-size: 14px; font-weight: bold;
        }

        .container {
            display: grid; grid-template-columns: repeat(3, 1fr);
            column-gap: 20px; row-gap: 0; flex-grow: 1;
        }

        .problem {
            font-weight: bold; display: flex; align-items: center;
            height: 50px; border-bottom: 1px solid #f0f0f0;
            justify-content: flex-start;
        }

        .mode-add .problem, .mode-sub .problem { font-size: 30px; }
        .mode-tripleAdd .problem, .mode-tripleSub .problem { font-size: 20px; }

        .index { font-size: 13px; color: #666; width: 30px; flex-shrink: 0; }
        .math-part { 
            display: inline-flex; 
            align-items: center; 
            font-family: "Courier New", Courier, monospace;
        }
        .num { display: inline-block; width: 1.2em; text-align: right; }
        .op { display: inline-block; width: 0.8em; text-align: center; margin: 0 1px; }

        .answer-box {
            width: 70px; height: 36px; border: 2px solid #000;
            margin-left: 8px; background: #fff; flex-shrink: 0;
        }

        /* 操作パネル */
        .no-print {
            background: #f4f4f4; padding: 15px; text-align: center;
            border-bottom: 2px solid #000;
        }
        .instruction-badge {
            display: inline-block; background: #000; color: white;
            padding: 2px 8px; border-radius: 4px; font-weight: bold; margin-bottom: 5px;
        }
        select { padding: 8px; font-size: 16px; margin-bottom: 10px; border-radius: 4px; }
        .btn-group { display: flex; justify-content: center; gap: 10px; }
        button {
            padding: 10px 15px; font-size: 16px; cursor: pointer;
            color: white; border: none; border-radius: 4px; font-weight: bold;
        }
        .btn-generate { background: #666; }
        .btn-print { background: #000; }
    </style>
</head>
<body class="mode-add">

<div class="no-print">
    <div class="instruction-badge">⚠️ スマホ印刷：必ず「横向き」に設定！</div>
    <br>
    <label for="mode">学習モード：</label><br>
    <select id="mode" onchange="changeMode()">
        <option value="add">Step1: 足し算(2桁)</option>
        <option value="sub">Step2: 引き算(2桁)</option>
        <option value="tripleAdd">Step3: 3つの足し算</option>
        <option value="tripleSub">Step4: 3つの引き算</option>
    </select>
    <div class="btn-group">
        <button class="btn-generate" onclick="generateProblems()">問題を更新</button>
        <button class="btn-print" onclick="window.print()">印刷する</button>
    </div>
</div>

<div class="content-wrapper">
    <div class="header">
        <h1 id="drill-title">Aoi’s Math Drill: Master of Addition</h1>
        <div class="landscape-hint no-print">向き：横</div>
    </div>

    <div class="info-section">
        <div>Date: ____ / ____ / ____</div>
        <div>Score: ________ / 24</div>
    </div>

    <div id="quiz-container" class="container"></div>
</div>

<script>
    function changeMode() {
        const mode = document.getElementById('mode').value;
        const title = document.getElementById('drill-title');
        document.body.className = 'mode-' + mode;
        const titles = {
            add: "Aoi’s Math Drill: Addition (2-Digit)",
            sub: "Aoi’s Math Drill: Subtraction (2-Digit)",
            tripleAdd: "Aoi’s Math Drill: Triple Addition",
            tripleSub: "Aoi’s Math Drill: Triple Subtraction"
        };
        title.innerText = titles[mode];
        generateProblems();
    }

    function generateProblems() {
        const mode = document.getElementById('mode').value;
        const container = document.getElementById('quiz-container');
        container.innerHTML = '';
        for (let i = 1; i <= 24; i++) {
            let mathHtml = "";
            if (mode === 'add') {
                const n1 = rand(10, 99); const n2 = rand(10, 99);
                mathHtml = createMathHtml([n1, "+", n2]);
            } else if (mode === 'sub') {
                const n1 = rand(30, 99); const n2 = rand(10, n1 - 10);
                mathHtml = createMathHtml([n1, "-", n2]);
            } else if (mode === 'tripleAdd') {
                const n1 = rand(10, 30); const n2 = rand(10, 30); const n3 = rand(10, 30);
                mathHtml = createMathHtml([n1, "+", n2, "+", n3]);
            } else if (mode === 'tripleSub') {
                const n1 = rand(50, 99); const n2 = rand(10, 30); const n3 = rand(1, n1 - n2 - 5);
                mathHtml = createMathHtml([n1, "-", n2, "-", n3]);
            }
            const div = document.createElement('div');
            div.className = 'problem';
            div.innerHTML = `<span class="index">(${i})</span><div class="math-part">${mathHtml}<span class="op">=</span></div><div class="answer-box"></div>`;
            container.appendChild(div);
        }
    }
    function rand(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
    function createMathHtml(parts) {
        return parts.map(p => {
            if (typeof p === 'number') return `<span class="num">${p}</span>`;
            return `<span class="op">${p}</span>`;
        }).join('');
    }
    generateProblems();
</script>

</body>
</html>